// public/scripts/admin.js
document.addEventListener("DOMContentLoaded", () => {
  const requestsTableBody = document.querySelector("#requestsTable tbody");

  // Load all shift requests (pending, approved, and rejected)
  function loadRequests() {
    fetch('/api/requests')
      .then(res => res.json())
      .then(requests => {
        requestsTableBody.innerHTML = "";
        requests.forEach((r, i) => {
          const row = requestsTableBody.insertRow();
          row.insertCell().textContent = i + 1;
          row.insertCell().textContent = r.date;
          row.insertCell().textContent = r.startTime;
          row.insertCell().textContent = r.endTime;
          row.insertCell().textContent = r.shiftType;
          row.insertCell().textContent = r.userName;
          row.insertCell().textContent = r.userEmail;
          row.insertCell().textContent = r.status;
          
          const actionCell = row.insertCell();
          if (r.status === "pending") {
            const approveBtn = document.createElement("button");
            approveBtn.textContent = "Approve";
            approveBtn.className = "btn primary-btn btn-small";
            approveBtn.style.marginRight = "5px";
            approveBtn.addEventListener("click", () => updateStatus(r.id, "approved"));
            
            const rejectBtn = document.createElement("button");
            rejectBtn.textContent = "Reject";
            rejectBtn.className = "btn danger-btn btn-small";
            rejectBtn.addEventListener("click", () => updateStatus(r.id, "rejected"));
            
            actionCell.appendChild(approveBtn);
            actionCell.appendChild(rejectBtn);
          } else {
            actionCell.textContent = "-";
          }
        });
      })
      .catch(err => console.error("Error loading requests:", err));
  }

  // Update the status of a request
  function updateStatus(requestId, status) {
    fetch(`/api/requests/${requestId}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ status })
    })
      .then(res => res.json())
      .then(() => loadRequests())
      .catch(err => console.error("Error updating status:", err));
  }

  loadRequests();
});
